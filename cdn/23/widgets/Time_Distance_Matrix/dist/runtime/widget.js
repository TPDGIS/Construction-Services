System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/geometryEngine"],(function(e,t){var o={},r={},n={},i={},a={},s={},u={},c={},l={};return{setters:[function(e){o.React=e.React,o.jsx=e.jsx},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.Button=e.Button,n.TextInput=e.TextInput},function(e){i.default=e.default},function(e){a.default=e.default},function(e){s.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){l.union=e.union}],execute:function(){e((()=>{var e={89:e=>{"use strict";e.exports=s},196:e=>{"use strict";e.exports=c},244:e=>{"use strict";e.exports=o},321:e=>{"use strict";e.exports=n},422:e=>{"use strict";e.exports=u},620:e=>{"use strict";e.exports=a},633:e=>{"use strict";e.exports=i},686:e=>{"use strict";e.exports=r},958:e=>{"use strict";e.exports=l}},t={};function d(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,d),n.exports}d.d=(e,t)=>{for(var o in t)d.o(t,o)&&!d.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var p={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(p),d.d(p,{__set_webpack_public_path__:()=>h,default:()=>y});var e=d(244),t=d(686),o=d(321),r=d(633),n=d(620),i=d(89),a=d(422),s=d(196),u=d(958),c=function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};const l="eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImZhMjIxNDQyMGNlNTQyOWM4MDg5MDkwZDA1ZWJkMzVkIiwiaCI6Im11cm11cjY0In0=",m="https://api.openrouteservice.org/v2/matrix/driving-car",f="https://api.openrouteservice.org/v2/directions/driving-car/geojson",g="https://services9.arcgis.com/izXUvkghw2ajVOfV/arcgis/rest/services/ConstructionServicesDepartmentEmployeeHomeLocation_ExportFeatures/FeatureServer/0";function y(d){var p;const[y,h]=e.React.useState(null),[x,v]=e.React.useState(null),[w,j]=e.React.useState(null),[b,N]=e.React.useState(""),[M,T]=e.React.useState("Waiting for map..."),[C,S]=e.React.useState([]),[k,I]=e.React.useState(null),[R,F]=e.React.useState([]),[E,D]=e.React.useState(null),[$,O]=e.React.useState(!1),[P,G]=e.React.useState("5"),_=["#32CD32","#00BFFF","#FFD700","#FF8C00","#DC143C"];e.React.useEffect((()=>{const e=null==y?void 0:y.view;if(e){if(!x){const t=new n.default({title:"Routes"});e.map.add(t),v(t)}if(!w){const t=new r.default({url:g});e.map.add(t),j(t)}T("Map ready.")}}),[y,x,w]);const J=()=>c(this,void 0,void 0,(function*(){const e=b.split("\n").map((e=>e.trim())).filter(Boolean),t=[];for(const o of e){const e=o.split(",").map((e=>parseFloat(e.trim())));if(2!==e.length||isNaN(e[0])||isNaN(e[1]))try{const e=encodeURIComponent(o),r=`https://api.openrouteservice.org/geocode/search?api_key=${l}&text=${e}`,n=yield fetch(r);if(!n.ok)throw new Error(`Geocode HTTP error: ${n.status}`);const i=yield n.json();if(i.features&&i.features.length>0){const[e,o]=i.features[0].geometry.coordinates;t.push(new a.default({longitude:e,latitude:o}))}else console.warn("No geocode results for:",o)}catch(e){console.warn("Geocoding failed for line:",o,e)}else t.push(new a.default({longitude:e[0],latitude:e[1]}))}return t})),z=e=>{const t=Math.floor(e/60),o=Math.round(e%60);return t>0?`${t} hr ${o} min`:`${o} min`};return(0,e.jsx)("div",{className:"p-3 space-y-2",style:{height:"100%",overflow:"auto",minHeight:0}},(0,e.jsx)("h4",null,"Time Matrix & Fastest Routes"),(0,e.jsx)("p",null,M),(0,e.jsx)(o.TextInput,{placeholder:"Enter destination (address or lon,lat)",value:b,onChange:e=>N(e.target.value)}),(0,e.jsx)("label",{className:"d-block mt-2"},"Number of routes"),(0,e.jsx)(o.TextInput,{type:"number",min:1,max:50,placeholder:"5",value:P,onChange:e=>G(e.target.value)}),(0,e.jsx)("div",{className:"d-flex justify-content-between mt-2"},(0,e.jsx)(o.Button,{type:"primary",onClick:()=>c(this,void 0,void 0,(function*(){if(!y||!w||!x)return void T("Map not ready yet.");const e=yield J();if(!e.length)return void T("Please enter at least one destination.");T("Querying origins...");const t=(yield w.queryFeatures({where:"1=1",outFields:["*"],returnGeometry:!0})).features||[],o=e[0],r=parseInt(P,10),n=isNaN(r)||r<1?5:Math.min(r,50);r!==n&&T(`Using ${n} routes (invalid or out-of-range input).`);const a=t.map((e=>{if("point"!==e.geometry.type)return null;const t=e.geometry;return{feature:e,distance:Math.hypot(t.longitude-o.longitude,t.latitude-o.latitude)}})).filter(Boolean).sort(((e,t)=>e.distance-t.distance)).slice(0,n);if(F(a),!a.length)return void T("No valid origin points found.");T("Generating routes..."),x.removeAll(),S([]);e.map((e=>new i.default({geometry:e,symbol:{type:"simple-marker",color:"red",size:10}}))).forEach((e=>x.add(e)));const c=a.map((e=>e.feature.geometry));c.forEach((e=>x.add(new i.default({geometry:e,symbol:{type:"simple-marker",color:"blue",size:10}}))));const d={locations:[...c,...e].map((e=>[e.longitude,e.latitude])),sources:c.map(((e,t)=>t)),destinations:e.map(((e,t)=>c.length+t)),metrics:["duration","distance"],units:"m"};let p=!1;const g=[];try{const t=yield fetch(m,{method:"POST",headers:{Authorization:l,"Content-Type":"application/json"},body:JSON.stringify(d)});if(!t.ok)throw new Error(`Matrix HTTP error: ${t.status}`);const o=yield t.json();for(let t=0;t<c.length;t++){const r=o.durations[t],n=o.distances[t];if(!r||!n)continue;let u=0,d=r[0];r.forEach(((e,t)=>{e<d&&(d=e,u=t)}));const m=c[t],y=e[u],h=yield fetch(f,{method:"POST",headers:{Authorization:l,"Content-Type":"application/json"},body:JSON.stringify({coordinates:[[m.longitude,m.latitude],[y.longitude,y.latitude]]})});if(!h.ok)continue;const x=(yield h.json()).features[0].geometry.coordinates,v=new s.default({paths:x}),w=new i.default({geometry:v,symbol:{type:"simple-line",color:"#000",width:4}}),j=new i.default({geometry:y,symbol:{type:"simple-marker",color:"red",size:10}}),b=n[u]/1609.34,N=d/60,M=`${a[t].feature.attributes.Name}`;g.push({Name:M,distanceMiles:b,durationText:z(N),color:"",graphic:w,destGraphic:j}),p=!0}if(!p)return void T("\u274c Failed to generate routes.");g.sort(((e,t)=>{const o=e=>{const t=e.split(" ");return t.includes("hr")?60*parseInt(t[0])+parseInt(t[2]):parseInt(t[0])};return o(e.durationText)-o(t.durationText)})),g.forEach(((e,t)=>e.color=t<5?_[t]:"#DC143C"));for(let e=g.length-1;e>=0;e--){const t=g[e];t.graphic.symbol={type:"simple-line",color:t.color,width:4},x.add(t.graphic),x.add(t.destGraphic)}S(g);const r=x.graphics.toArray().map((e=>e.geometry)),n=u.union(r);if(n){const e=y.view,t=n.extent.expand(1.8);D(t),yield e.goTo({target:t,duration:1e3,padding:250});const o=Math.min(.25,-300/e.width),r=t.width*o;t.xmin+=r,t.xmax+=r,yield e.goTo({target:t,duration:800})}const h=a.map((e=>`'${e.feature.attributes.Name}'`));w.definitionExpression=`Name IN (${h.join(",")})`,T("\u2705 Routes generated.")}catch(e){console.error(e),p||T("\u274c Failed to generate routes.")}})),className:"w-100 mr-2"},"Generate Time Matrix"),(0,e.jsx)(o.Button,{type:"primary",style:{backgroundColor:"#ffce2f"},className:"w-100",onClick:()=>window.location.reload()},"Reset")),(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(p=d.config.useMapWidgetIds)||void 0===p?void 0:p[0],onActiveViewChange:h}),C.length>0&&(0,e.jsx)("table",{className:"w-full mt-3 border border-gray-700 text-black text-sm"},(0,e.jsx)("thead",null,(0,e.jsx)("tr",{className:"bg-gray-800 text-black"},(0,e.jsx)("th",{className:"px-3 py-2 text-left"},"Employee"),(0,e.jsx)("th",{className:"px-3 py-2 text-left"},"Distance (Miles)"),(0,e.jsx)("th",{className:"px-3 py-2 text-left"},"Drive Duration"))),(0,e.jsx)("tbody",null,C.map(((t,o)=>{const r=o===k,n=r?t.color:`${t.color}40`;return(0,e.jsx)("tr",{key:o,onClick:()=>(e=>{if(!x||!w||!y)return;const t=y.view;if(k===e){I(null),x.graphics.forEach((e=>e.visible=!0));const e=R.map((e=>`'${e.feature.attributes.Name}'`));return w.definitionExpression=`Name IN (${e.join(",")})`,void(E&&t.goTo({target:E,duration:1e3,padding:250}))}I(e);const o=C[e];x.graphics.forEach((e=>e.visible=e===o.graphic||e===o.destGraphic));const r=o.graphic.geometry.extent.expand(1.8),n=Math.min(.25,-300/t.width),i=r.width*n;r.xmin+=i,r.xmax+=i,t.goTo({target:r,duration:1e3,padding:250})})(o),style:{backgroundColor:n,opacity:r?1:.6,border:r?"2px solid white":"1px solid #444"}},(0,e.jsx)("td",{className:"px-3 py-2"},t.Name),(0,e.jsx)("td",{className:"px-3 py-2"},t.distanceMiles.toFixed(2)),(0,e.jsx)("td",{className:"px-3 py-2"},t.durationText))})))))}function h(e){d.p=e}})(),p})())}}}));
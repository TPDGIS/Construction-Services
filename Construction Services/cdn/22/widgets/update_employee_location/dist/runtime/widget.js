System.register(["jimu-core","jimu-ui","esri/layers/FeatureLayer","esri/Graphic","esri/geometry/Point"],(function(e,t){var r={},o={},i={},n={},s={};return{setters:[function(e){r.React=e.React,r.jsx=e.jsx},function(e){o.AlertPopup=e.AlertPopup,o.Button=e.Button,o.TextInput=e.TextInput},function(e){i.default=e.default},function(e){n.default=e.default},function(e){s.default=e.default}],execute:function(){e((()=>{var e={89:e=>{"use strict";e.exports=n},244:e=>{"use strict";e.exports=r},321:e=>{"use strict";e.exports=o},422:e=>{"use strict";e.exports=s},633:e=>{"use strict";e.exports=i}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,a),i.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var l={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(l),a.d(l,{__set_webpack_public_path__:()=>p,default:()=>d});var e=a(244),t=a(321),r=a(633),o=a(89),i=a(422),n=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{l(o.next(e))}catch(e){n(e)}}function a(e){try{l(o.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};const s="https://services9.arcgis.com/izXUvkghw2ajVOfV/arcgis/rest/services/ConstructionServicesDepartmentEmployeeHomeLocation_ExportFeatures/FeatureServer/0",u="eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImZhMjIxNDQyMGNlNTQyOWM4MDg5MDkwZDA1ZWJkMzVkIiwiaCI6Im11cm11cjY0In0=",c=["Name","Address","Job_Title","Department","Employee_ID"];function d(a){const l=e.React.useRef(null),[d,p]=e.React.useState([]),[g,y]=e.React.useState(!0),[f,m]=e.React.useState(null),[v,b]=e.React.useState({}),[j,x]=e.React.useState(!1),[h,S]=e.React.useState(""),[C,R]=e.React.useState("idle"),[w,O]=e.React.useState(!1);e.React.useEffect((()=>{let e=!1;const t=new r.default({url:s});return l.current=t,t.queryFeatures({where:"1=1",outFields:["*"],returnGeometry:!0}).then((t=>{!e&&t.features&&t.features.length>0&&p(t.features)})).catch((()=>{e||S("Failed to load features"),e||R("error")})).finally((()=>{e||y(!1)})),()=>{e=!0,l.current=null}}),[]);const k=e.React.useCallback((e=>{const t=e.target.value;if(!t)return m(null),b({}),void x(!1);const r=d.find((e=>String(e.attributes.OBJECTID)===t));r&&(m(r),b(Object.assign({},r.attributes)),x(!1))}),[d]),B=e.React.useCallback(((e,t)=>{b((r=>Object.assign(Object.assign({},r),{[e]:t}))),x(!0)}),[]),I=e.React.useCallback((()=>n(this,void 0,void 0,(function*(){var e,t,r,s;const a=l.current;if(!a||!f||!j)return;S("Updating..."),R("busy");const c=f.attributes.OBJECTID;let d=null===(e=f.geometry)||void 0===e?void 0:e.clone();const p=f.attributes.Address,g=v.Address,y=Object.assign(Object.assign({},v),{OBJECTID:c});if(null!=g&&""!==String(g).trim()&&String(g)!==String(null!=p?p:"")){const e=yield function(e){return n(this,void 0,void 0,(function*(){if(!e||!e.trim())return null;const t=encodeURIComponent(e.trim()),r=`https://api.openrouteservice.org/geocode/search?api_key=${u}&text=${t}`;try{const e=yield fetch(r);if(!e.ok)return null;const t=yield e.json();if(t.features&&t.features.length>0){const e=t.features[0].geometry.coordinates;return{longitude:e[0],latitude:e[1]}}return null}catch(e){return null}}))}(String(g));e&&(d=new i.default({longitude:e.longitude,latitude:e.latitude,spatialReference:{wkid:4326}}),y.Longitude=e.longitude,y.Latitude=e.latitude)}const h=new o.default({geometry:null!=d?d:f.geometry,attributes:y});try{const e=null===(t=(yield a.applyEdits({updateFeatures:[h]})).updateResults)||void 0===t?void 0:t[0];null!=(null==e?void 0:e.error)&&(null===(r=e.error)||void 0===r?void 0:r.message)?(S(null!==(s=e.error.message)&&void 0!==s?s:"Update failed"),R("error")):(S("Updated successfully."),R("success"),x(!1),b(y),m(h))}catch(e){S(`Error: ${e.message}`),R("error")}}))),[f,j,v]),D=e.React.useCallback((()=>O(!0)),[]),E=e.React.useCallback((()=>n(this,void 0,void 0,(function*(){var e,t,r;const o=l.current,i=f;if(o&&i){S("Deleting..."),R("busy");try{const n=null===(e=(yield o.applyEdits({deleteFeatures:[i]})).deleteResults)||void 0===e?void 0:e[0];null!=(null==n?void 0:n.error)&&(null===(t=n.error)||void 0===t?void 0:t.message)?(S(null!==(r=n.error.message)&&void 0!==r?r:"Delete failed"),R("error")):(p((e=>e.filter((e=>e.attributes.OBJECTID!==i.attributes.OBJECTID)))),m(null),b({}),x(!1),S("Employee removed."),R("success"))}catch(e){S(`Error: ${e.message}`),R("error")}}}))),[f]),T=e.React.useCallback((e=>{O(!1),e&&E()}),[E]),J=e.React.useMemo((()=>[...d].sort(((e,t)=>{var r,o,i,n;return String(null!==(o=null===(r=e.attributes)||void 0===r?void 0:r.Name)&&void 0!==o?o:"").localeCompare(String(null!==(n=null===(i=t.attributes)||void 0===i?void 0:i.Name)&&void 0!==n?n:""),void 0,{sensitivity:"base"})}))),[d]),N=f?c.filter((e=>Object.prototype.hasOwnProperty.call(v,e))):[],_="error"===C?"#c00":"success"===C?"#0a0":"busy"===C?"#06c":"#666";return g?(0,e.jsx)("div",{className:"update-employee-location-widget jimu-widget",style:{padding:12,height:"100%"}},(0,e.jsx)("div",{style:{fontSize:14,color:"#666"}},"Loading features...")):(0,e.jsx)("div",{className:"update-employee-location-widget jimu-widget",style:{padding:12,height:"100%",overflow:"auto"}},(0,e.jsx)("div",{style:{fontWeight:"bold",fontSize:16,marginBottom:4}},"Update Employee Location"),(0,e.jsx)("div",{style:{fontSize:12,color:"#666",marginBottom:12}},"Select a feature, edit attributes, then click Update. Changing Address will move the point."),(0,e.jsx)("div",{style:{marginBottom:12}},(0,e.jsx)("label",{style:{display:"block",fontSize:12,marginBottom:4}},"Select feature"),(0,e.jsx)("select",{value:f?String(f.attributes.OBJECTID):"",onChange:k,style:{width:"100%",padding:"6px",fontSize:12,border:"1px solid #ccc",borderRadius:4}},(0,e.jsx)("option",{value:""},"-- Select --"),J.map((t=>{var r,o;return(0,e.jsx)("option",{key:t.attributes.OBJECTID,value:String(t.attributes.OBJECTID)},null!==(o=null!==(r=t.attributes.Name)&&void 0!==r?r:t.attributes.OBJECTID)&&void 0!==o?o:"Feature")})))),f&&(0,e.jsx)("div",{style:{marginBottom:12}},(0,e.jsx)("div",{style:{fontSize:12,fontWeight:"bold",marginBottom:6}},"Attributes"),N.map((r=>{var o;return(0,e.jsx)("div",{key:r,style:{marginBottom:6}},(0,e.jsx)("label",{style:{display:"block",fontSize:11,marginBottom:2}},r),(0,e.jsx)(t.TextInput,{value:String(null!==(o=v[r])&&void 0!==o?o:""),onChange:e=>B(r,e.target.value),style:{width:"100%"}}))}))),(0,e.jsx)("div",{style:{marginBottom:8}},(0,e.jsx)(t.Button,{type:"primary",onClick:I,disabled:!j||!f,style:{marginRight:8}},"Update"),(0,e.jsx)(t.Button,{type:"primary",onClick:D,disabled:!f,style:{backgroundColor:"#c00",borderColor:"#c00"}},"Delete Employee")),(0,e.jsx)(t.AlertPopup,{isOpen:w,toggle:T,title:"Remove employee",description:"Would you like to remove this employee?",okLabel:"Yes",cancelLabel:"No",severity:"warning"}),h&&(0,e.jsx)("div",{style:{fontSize:12,color:_,marginTop:8}},h))}function p(e){a.p=e}})(),l})())}}}));